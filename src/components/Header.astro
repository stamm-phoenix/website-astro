---
const nav = [
  { href: '/', label: 'Start' },
  { href: '/gruppenstunden', label: 'Gruppenstunden' },
  { href: '/blog', label: 'Blog' },
  { href: '/kontakt', label: 'Kontakt' }, // add the page when ready
];
---
<div class="container flex items-center gap-6 py-3 md:py-4 relative">
  <a href="/" class="flex items-center gap-3 group" aria-label="Stamm Phoenix – DPSG Feldkirchen-Westerham">
    <div
      class="size-12 md:size-14 flex items-center justify-center bg-none shadow-sm overflow-hidden transition-transform duration-200 group-hover:scale-105 group-hover:ring-neutral-300"
      aria-hidden="true"
    >
      <img
        src="/logo.png"
        alt="Stamm Phoenix Logo"
        class="w-10 h-10 md:w-12 md:h-12 object-contain select-none"
        loading="eager"
        decoding="async"
      />
    </div>
    <div class="leading-tight">
      <div class="text-base md:text-lg font-semibold text-neutral-900">Stamm Phoenix</div>
      <div class="text-xs md:text-sm text-neutral-600">DPSG Feldkirchen-Westerham</div>
    </div>
  </a>

  <!-- Desktop nav -->
  <nav class="ml-auto hidden md:block">
    <ul class="flex items-center gap-1 md:gap-2">
      {nav.map((item) => (
        <li>
          <a
            href={item.href}
            class="inline-block rounded-sm px-3 py-2 text-sm font-medium no-underline text-neutral-900 hover:bg-neutral-100 focus-visible:bg-neutral-100 aria-[current=page]:text-brand-700 aria-[current=page]:underline"
            aria-current={Astro.url.pathname === item.href ? 'page' : undefined}
          >
            {item.label}
          </a>
        </li>
      ))}
      <li>
        <a
          href="https://mitmachen.stamm-phoenix.de"
          class="inline-flex items-center rounded-md bg-brand-600 px-3 py-2 text-sm font-semibold text-white shadow hover:bg-brand-500 hover:shadow-md focus-visible:bg-brand-500 transition"
        >
          Mitmachen
        </a>
      </li>
    </ul>
  </nav>

  <!-- Mobile: hamburger -->
  <div class="ml-auto md:hidden">
    <button
      id="menu-btn"
      type="button"
      class="inline-flex items-center justify-center rounded-md p-2 text-neutral-700 hover:bg-neutral-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-600"
      aria-label="Menü öffnen"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <!-- Hamburger icon -->
      <svg id="icon-open" class="size-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path stroke-linecap="round" d="M3 6h18M3 12h18M3 18h18" />
      </svg>
      <!-- Close icon -->
      <svg id="icon-close" class="size-6 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path stroke-linecap="round" d="M6 6l12 12M18 6l-12 12" />
      </svg>
    </button>
  </div>
  <!-- Mobile menu panel -->
  <div
    id="mobile-menu"
    class="fixed right-3 top-16 z-[100000] mt-0 w-64 rounded-md border border-neutral-200 bg-white shadow-lg p-2 hidden md:hidden"
  >
    <ul class="flex flex-col gap-1">
      {nav.map((item) => (
        <li>
          <a
            href={item.href}
            class="block rounded-sm px-3 py-2 text-sm font-medium no-underline text-neutral-900 hover:bg-neutral-100 focus-visible:bg-neutral-100 aria-[current=page]:text-brand-700 aria-[current=page]:underline"
            aria-current={Astro.url.pathname === item.href ? 'page' : undefined}
          >
            {item.label}
          </a>
        </li>
      ))}
      <li class="pt-1">
        <a
          href="https://mitmachen.stamm-phoenix.de"
          class="inline-flex w-full items-center justify-center rounded-md bg-brand-600 px-3 py-2 text-sm font-semibold text-white shadow hover:bg-brand-500 hover:shadow-md focus-visible:bg-brand-500 transition"
        >
          Mitmachen
        </a>
      </li>
    </ul>
  </div>

  <script>
    const btn = document.getElementById('menu-btn');
    const menu = document.getElementById('mobile-menu');
    const iconOpen = document.getElementById('icon-open');
    const iconClose = document.getElementById('icon-close');

    function closeOnEscape(e) {
      if (e.key === 'Escape') {
        hideMenu();
      }
    }
    function hideMenu() {
      menu?.classList.add('hidden');
      iconOpen?.classList.remove('hidden');
      iconClose?.classList.add('hidden');
      btn?.setAttribute('aria-expanded', 'false');
      document.removeEventListener('keydown', closeOnEscape);
    }
    function toggleMenu() {
      const willOpen = menu?.classList.contains('hidden');
      if (willOpen) {
        menu.classList.remove('hidden');
        iconOpen?.classList.add('hidden');
        iconClose?.classList.remove('hidden');
        btn?.setAttribute('aria-expanded', 'true');
        document.addEventListener('keydown', closeOnEscape);
      } else {
        hideMenu();
      }
    }
    btn?.addEventListener('click', toggleMenu);
    // Close when clicking outside
    document.addEventListener('click', (e) => {
      if (!menu || !btn) return;
      if (menu.classList.contains('hidden')) return;
      const target = e.target;
      if (!(target instanceof Node)) return;
      if (!menu.contains(target) && !btn.contains(target)) hideMenu();
    });
  </script>
</div>