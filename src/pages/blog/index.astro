---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const sortedPosts = posts.sort((a, b) => 
  new Date(b.data.date || '').getTime() - new Date(a.data.date || '').getTime()
);
---
<BaseLayout title="Blog | Stamm Phoenix" description="Neuigkeiten und Berichte aus dem Stamm.">
  <svelte:fragment slot="header"><Header /></svelte:fragment>

  <section class="prose">
    <h1>Blog</h1>
    <p>Neuigkeiten, Berichte und Einblicke.</p>
  </section>

  <ul class="mt-6 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {sortedPosts.map((post) => (
      <li class="group rounded-[var(--radius-lg)] border border-[var(--color-neutral-200)] bg-white p-5 shadow-[var(--shadow-soft)] hover:shadow-md transition">
        <a href={`/blog/${post.id.replace('.md', '')}`} class="no-underline">
          <div class="flex flex-col gap-2">
            <h3 class="text-lg font-semibold text-[var(--color-neutral-900)] group-hover:underline">
              {post.data.title}
            </h3>
            <div class="text-sm text-[var(--color-neutral-700)]">
              {post.data.date} {post.data.author ? `â€” ${post.data.author}` : ''}
            </div>
            {post.data.description && (
              <p class="text-sm text-[var(--color-neutral-700)]">{post.data.description}</p>
            )}
          </div>
        </a>
      </li>
    ))}
  </ul>

  <svelte:fragment slot="footer"><Footer /></svelte:fragment>
</BaseLayout>